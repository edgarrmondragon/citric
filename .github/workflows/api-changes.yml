name: API Changes

on:
  pull_request:
    paths:
    - src/**
    - .github/workflows/api-changes.yml

concurrency:
  group: ${{ github.workflow }}-${{ github.head_ref || github.run_id }}
  cancel-in-progress: true

jobs:
  check-api-changes:
    name: Check API Changes
    runs-on: ubuntu-latest
    env:
      NOXSESSION: api
    steps:
    - name: Check out the repository
      uses: actions/checkout@v3.5.3

    - name: Setup Python
      uses: actions/setup-python@v4.7.0
      with:
        python-version: 3.11

    - name: Install tools
      env:
        PIP_CONSTRAINT: .github/workflows/constraints.txt
      run: |
        pip install pip
        pipx install griffe
        pipx install nox
        pipx inject nox nox-poetry
        pipx list

    - name: Run Nox
      run: |
        nox -- ${{ github.base_ref }}
